# 自己动手构造编译系统
## 编译系统概述
- 编译器: 输入为源文件(\*.c),输出为汇编文件(\*.s)  
  词法分析->语法分析->符号表管理->语义分析->编译优化->代码生成  
  现代编译器结构如图:  
  [![JEHfht.md.png](https://s1.ax1x.com/2020/04/17/JEHfht.md.png)](https://imgchr.com/i/JEHfht)  
  [![JEbV9x.md.png](https://s1.ax1x.com/2020/04/17/JEbV9x.md.png)](https://imgchr.com/i/JEbV9x)  
      
- 汇编器: 输入为源文件(\*.s),输出为可重定位文件(\*.o)   
  词法分析->语法分析->表信息生成(ELF文件中的段表,符号表,重定位表)->指令生成->目标文件生成  
  汇编器结构如图:  
  [![JEbaDg.png](https://s1.ax1x.com/2020/04/17/JEbaDg.png)](https://imgchr.com/i/JEbaDg)  

- 链接器:输入为可重定位文件(\*.o),输出为可执行文件ELF  
  地址空间分配->符号解析->重定位  
  链接器结构如图:  
  [![JEqiM8.md.png](https://s1.ax1x.com/2020/04/17/JEqiM8.md.png)](https://imgchr.com/i/JEqiM8)  

- ELF文件格式  
  linux下ELF主要有四种:可执行文件,可重定位目标文件,共享目标文件(动态链接器相关),核心转储文件(coreDump,错误现场相关)  
  ELF格式如图:  
  [![JELCk9.png](https://s1.ax1x.com/2020/04/17/JELCk9.png)](https://imgchr.com/i/JELCk9)  
## 编译器构造
### 词法分析  
此法分析器结构如图:  
[![JZ5NDJ.png](https://s1.ax1x.com/2020/04/17/JZ5NDJ.png)](https://imgchr.com/i/JZ5NDJ)  
- 扫描器读取源文件,按序返回文件内的字符,直到文件结束
- 词法记号通常分为:标识符、关键字、常量、分界符
- 有限自动机分为NFA和DFA,DFA识别的语言称为正则语言
- 解析器根据DFA/NFA完成词法记号的解析,实现方式有基于表驱动(词法分析器生成工具一般用这种方式)和硬编码(程序直接解析,效率较高)两种  
  EAC中还有介绍一种Direct-Coded, 因该是介于自动化生成与手工编码之间
### 语法分析
### 符号表管理
### 语义分析
### 语义优化
#### 数据流分析
#### 中间代码优化
#### 寄存器分配(业界编译器一般是后端部分)
#### 窥孔优化(后端的指令选择过程中会涉及)
### 代码生成
## 汇编器构造
### 词法分析
### 语法分析
### 符号表管理
### 表信息生成
### 指令生成
### 目标文件生成
## 链接器构造(static)
### 信息收集
### 地址空间分配
### 符号解析
### 重定位
### 程序入口点与运行时库
### 可执行文件生成